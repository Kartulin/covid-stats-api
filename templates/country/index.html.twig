{% extends 'base.html.twig' %}

{% block title %}Country index{% endblock %}

{% block body %}
    <h1>Country index</h1>
    <div class="row">
        <div class="col">total: {{ pager.count }}</div>
        <div class="col"></div>
        <div class="col">
            <form action="{{ path('country.index') }}" class="form form-control">
                <label>
                    <input type="text" class="form-control" name="search" value="{{ app.request.query.get('search') }}"
                           placeholder="search name...">
                </label>
                <button class="btn btn-primary" type="submit">Filter</button>
                {% if app.request.query.count %}
                    <a class="btn btn-danger" href="{{ path('country.index') }}">X</a>
                {% endif %}
            </form>
        </div>
    </div>
    <table class="table table-hover">
        {% if app.request.query.get('direction') == 'desc' %}
            {% set nextDirection = 'asc' %}
        {% else %}
            {% set nextDirection = 'desc' %}
        {% endif %}
        {% set queryParams = app.request.query.all %}
        <thead>
        <tr>
            <th>Id</th>
            <th>continent</th>
            <th>code</th>
            <th>
                <a href="{{ path('country.index',
                    queryParams|merge({sortBy: 'name', direction: nextDirection })) }}">
                    Name
                </a>
                <i class="bi bi-sort-down"></i>
            </th>
            <th>Confirmed</th>
            <th>Deaths</th>
            <th>Recovered</th>
            <th>UpdatedAt</th>
            <th>actions</th>
        </tr>
        </thead>
        <tbody>
        {% for country in pager %}
            <tr>
                <td>{{ country.id }}</td>
                <td>{{ country.continent | default('--') }}</td>
                <td>
                    <p class="d-inline-flex">
                        <img src="{{ asset('flags-malenkie/') }}{{ country.flag }}" alt="flag"/>
                        &nbsp;<strong>{{ country.code }}</strong></p>
                </td>
                <td>{{ country.name }}</td>
                <td>{{ country.totalConfirmed | default('--') }}
                    {% if country.newConfirmed != 0 %}
                        <small>({{ country.newConfirmed | default('--') }})</small>
                    {% endif %}
                </td>
                <td>{{ country.totalDeaths | default('--') }}<small>({{ country.newDeaths | default('--') }})</small>
                </td>
                <td>{{ country.totalRecovered | default('--') }}<small>({{ country.newRecovered | default('--') }}
                        )</small></td>
                <td>{{ country.updatedAt ? country.updatedAt|date('Y-m-d H:m:s') : '' }}</td>
                <td>
                    <a href="{{ path('country.show', {'slug': country.slug}) }}">show</a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="7">no records found</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {# display navigation #}
    <div class="navigation float-end">
        {{ pagerfanta(pager, {'omitFirstPage': true }) }}
    </div>
{% endblock %}
